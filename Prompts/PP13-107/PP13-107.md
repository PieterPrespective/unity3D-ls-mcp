# PP13-107: Phase 5 - Documentation and Polish

## Assignment Overview

| Field | Value |
|-------|-------|
| **Issue ID** | PP13-107 |
| **Parent Issue** | PP13-102 |
| **Depends On** | PP13-103 (Phase 1), PP13-104 (Phase 2), PP13-105 (Phase 3), PP13-106 (Phase 4) |
| **Phase** | 5 of 5 (Final) |
| **Title** | Documentation and Polish |
| **Reference** | [DevRoadmap.md](../../Documentation/tdd/DevRoadmap.md) - Phase 5 |
| **Technical Analysis** | [Unity-CSharp-LSP-MCP-Honest-Report.md](../../Documentation/tdd/Unity-CSharp-LSP-MCP-Honest-Report.md) |

---

## Objective

Complete the ULSM project documentation and prepare for release. This final phase transforms the forked dotnet-roslyn-mcp into a polished, well-documented Unity-focused MCP server. Deliverables include:

1. **README.md** - Complete rewrite with ULSM branding and Unity-specific documentation
2. **CHANGELOG.md** - Document all changes from the fork
3. **MCP Client Configurations** - Ready-to-use examples for Claude Code and other clients
4. **Troubleshooting Guide** - Common Unity project loading issues and solutions
5. **Architecture Documentation** - Updated diagrams showing Unity integration
6. **Tool Reference** - Comprehensive documentation of all 22+ tools
7. **Release Preparation** - Version tagging, NuGet package metadata

---

## Background: Why Documentation Matters

ULSM differentiates itself from the upstream dotnet-roslyn-mcp through Unity-specific enhancements:

- **Unity Project Detection** - Automatic recognition of Unity solutions by folder structure, Assembly-CSharp.csproj, and HintPath references
- **Legacy csproj Support** - MSBuild configuration for Unity's ToolsVersion 4.0 format
- **Framework Path Resolution** - Cross-platform .NET Framework 4.7.1 reference assembly discovery
- **AdhocWorkspace Fallback** - Manual csproj parsing when MSBuild fails
- **Microsoft.Unity.Analyzers** - 50+ Unity-specific diagnostic rules (UNT0001-UNT0xxx)
- **Custom Pattern Analyzers** - ULSM0001-0004 for hot path detection
- **API Migration Checking** - 30+ Unity 6.x deprecation rules

Without proper documentation, users cannot leverage these capabilities. The current README still references "Roslyn MCP Server" and "dotnet-roslyn-mcp", creating confusion about the project's purpose.

---

## Pre-Implementation Checklist

Before starting implementation, verify:

- [ ] Read and understand `Prompts/BasePrompt.md` for project conventions
- [ ] Read `Documentation/tdd/DevRoadmap.md` Phase 5 section completely
- [ ] Verify dev-diary branch is `ULSM-PWS` (not `main`)
- [ ] Verify knowledge-agent branch is `ULSM-PWS` (not `main`)
- [ ] Verify PP13-106 commits are present (`git log --oneline -10`)
- [ ] `dotnet build ULSM.sln` succeeds on current codebase
- [ ] `dotnet test ULSM.sln` passes (all tests green)
- [ ] Create registry entry for PP13-107 in dev diary
- [ ] Log implementation plan in dev diary

---

## Current State Assessment

### Files Requiring Updates

| File | Current State | Action Needed |
|------|---------------|---------------|
| `README.md` | Original dotnet-roslyn-mcp content | **Complete rewrite** |
| `src/server.json` | Updated for ULSM | Minor polish |
| `LICENSE` | MIT - Brendan Kowitz | Add Prespective attribution |
| `CHANGELOG.md` | Does not exist | **Create** |
| `Documentation/` | Has TDD docs | Add user-facing docs |

### Existing Documentation to Preserve/Reference

- `Documentation/tdd/DevRoadmap.md` - Development roadmap (internal)
- `Documentation/tdd/Unity-CSharp-LSP-MCP-Honest-Report.md` - Technical analysis (internal)

---

## Implementation Tasks

### Task 1: Create README.md

Replace the entire README.md with ULSM-focused documentation.

**File:** `README.md`

```markdown
# ULSM - Unity Language Server MCP

[![NuGet Tool](https://img.shields.io/badge/.NET%20Tool-Install-blue?logo=nuget)](https://www.nuget.org/packages/ulsm)
[![.NET 8.0](https://img.shields.io/badge/.NET-8.0-512BD4?logo=dotnet)](https://dotnet.microsoft.com/download/dotnet/8.0)
[![Unity 6](https://img.shields.io/badge/Unity-6.x-000000?logo=unity)](https://unity.com)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

A Model Context Protocol (MCP) server providing Roslyn-based semantic code analysis for **Unity 6.x projects**. ULSM extends [dotnet-roslyn-mcp](https://github.com/brendankowitz/dotnet-roslyn-mcp) with Unity-aware workspace loading, Unity-specific analyzers, and API migration checking.

**22+ powerful tools** including Unity diagnostics, pattern analysis, API migration checks, impact analysis, safe refactoring, and dependency visualization!

## Why ULSM?

Unity projects have unique challenges that standard Roslyn tools don't handle well:

| Challenge | ULSM Solution |
|-----------|---------------|
| Unity's legacy .csproj format (ToolsVersion 4.0) | Automatic MSBuild configuration |
| Absolute HintPath references to Unity DLLs | Framework path resolution + fallback parsing |
| Unity-specific anti-patterns (GetComponent in Update) | Microsoft.Unity.Analyzers + custom pattern detection |
| API deprecations in Unity 6.x | 30+ migration rules with fix suggestions |

## Features

### Standard Roslyn Capabilities
- **Semantic Analysis**: 100% compiler-accurate code understanding
- **Cross-Solution Navigation**: Find references, implementations, callers, and type hierarchies
- **Impact Analysis**: See what code calls your methods before refactoring
- **Safe Refactoring**: Rename symbols across solution with preview mode
- **Dead Code Detection**: Find unused types, methods, and fields
- **Real-time Diagnostics**: Get compilation errors and warnings

### Unity-Specific Enhancements
- **Unity Project Detection**: Automatically detects Unity solutions by folder structure
- **Unity Diagnostics**: 50+ rules from Microsoft.Unity.Analyzers (UNT0001-UNT0xxx)
- **Hot Path Analysis**: Custom ULSM rules for GetComponent in Update, Camera.main, etc.
- **API Migration**: Check for deprecated Unity APIs with suggested replacements
- **Legacy Format Support**: Handles Unity's ToolsVersion 4.0 csproj files

## Quick Start

### Prerequisites

- .NET 8.0 SDK or Runtime
- (Optional) .NET Framework 4.7.1 Reference Assemblies (for full Unity DLL resolution)

### Installation

```bash
# Install as global tool
dotnet tool install --global ulsm

# Verify installation
ulsm --version
```

### Configure Claude Code

```bash
# Add ULSM to Claude Code
claude mcp add --transport stdio ulsm \
  --env DOTNET_SOLUTION_PATH="/path/to/YourUnityProject.sln" \
  -- ulsm
```

For Unity projects, you may also want to set the framework path:

```bash
claude mcp add --transport stdio ulsm \
  --env DOTNET_SOLUTION_PATH="/path/to/YourUnityProject.sln" \
  --env ULSM_FRAMEWORK_PATH="C:/Program Files (x86)/Reference Assemblies/Microsoft/Framework/.NETFramework/v4.7.1" \
  -- ulsm
```

## Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `DOTNET_SOLUTION_PATH` | (Required) | Path to .sln file or directory containing it |
| `ULSM_LOG_LEVEL` | Information | Logging level (Debug, Information, Warning, Error) |
| `ULSM_MAX_DIAGNOSTICS` | 100 | Maximum diagnostics to return per request |
| `ULSM_TIMEOUT_SECONDS` | 30 | Operation timeout (increase for large solutions) |
| `ULSM_FRAMEWORK_PATH` | (Auto-detect) | Override path to .NET Framework 4.7.1 reference assemblies |
| `ULSM_FORCE_ADHOC` | false | Force AdhocWorkspace instead of MSBuildWorkspace |
| `UNITY_EDITOR_PATH` | (Auto-detect) | Path to Unity Editor installation for reference resolution |

### Framework Path Locations

ULSM automatically searches for .NET Framework 4.7.1 reference assemblies:

**Windows:**
- `C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.7.1`
- `C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.8`

**macOS:**
- `/Library/Frameworks/Mono.framework/Versions/Current/lib/mono/4.7.1-api`

**Linux:**
- `/usr/lib/mono/4.7.1-api`

If these paths don't exist on your system, set `ULSM_FRAMEWORK_PATH` manually or install the .NET Framework Targeting Pack.

## Available Tools (22 Total)

### Core & Health
| Tool | Description |
|------|-------------|
| `ulsm:health_check` | Check server health and workspace status (includes Unity detection info) |
| `ulsm:load_solution` | Load a .NET/Unity solution for analysis |
| `ulsm:get_symbol_info` | Get detailed semantic information about a symbol |

### Navigation
| Tool | Description |
|------|-------------|
| `ulsm:go_to_definition` | Navigate to symbol definition |
| `ulsm:find_references` | Find all references to a symbol |
| `ulsm:find_implementations` | Find all implementations of an interface/abstract class |
| `ulsm:find_callers` | Find all methods that call a specific method (impact analysis) |
| `ulsm:get_type_hierarchy` | Get inheritance hierarchy for a type |

### Search
| Tool | Description |
|------|-------------|
| `ulsm:search_symbols` | Search for symbols by name across solution |
| `ulsm:semantic_query` | Natural language semantic search |

### Diagnostics
| Tool | Description |
|------|-------------|
| `ulsm:get_diagnostics` | Get compiler errors and warnings |
| `ulsm:get_code_fixes` | Get available code fixes for diagnostics |
| `ulsm:apply_code_fix` | Apply a specific code fix |

### Structure
| Tool | Description |
|------|-------------|
| `ulsm:get_project_structure` | Get solution/project structure |
| `ulsm:get_method_overloads` | Get all overloads of a method |
| `ulsm:get_containing_member` | Get containing method/property/class info |
| `ulsm:dependency_graph` | Visualize project dependencies and detect cycles |

### Refactoring
| Tool | Description |
|------|-------------|
| `ulsm:organize_usings` | Sort and remove unused using directives |
| `ulsm:organize_usings_batch` | Organize usings across multiple files |
| `ulsm:format_document_batch` | Format multiple documents |
| `ulsm:rename_symbol` | Safely rename symbol across solution with preview |
| `ulsm:extract_interface` | Generate interface from class for DI/testability |

### Analysis
| Tool | Description |
|------|-------------|
| `ulsm:find_unused_code` | Find dead code (unused types, methods, fields) |

### Unity Analysis (New in ULSM)
| Tool | Description |
|------|-------------|
| `ulsm:unity_diagnostics` | Get Unity-specific diagnostics (UNT0001, UNT0002, etc.) |
| `ulsm:check_unity_patterns` | Check for Unity anti-patterns (ULSM0001-0004) |
| `ulsm:api_migration` | Check for deprecated Unity APIs with migration suggestions |
| `ulsm:list_unity_rules` | List all available Unity diagnostic rules |

## Unity Diagnostics Reference

### Microsoft.Unity.Analyzers (UNT Rules)

| ID | Description | Severity |
|----|-------------|----------|
| UNT0001 | Empty Unity message (Update, Start, etc.) | Warning |
| UNT0002 | Inefficient tag comparison (use CompareTag) | Warning |
| UNT0003 | Usage of non-generic GetComponent | Info |
| UNT0006 | Incorrect message signature | Error |
| UNT0010 | MonoBehaviour instance created with new | Warning |
| UNT0014 | Invalid method for GetComponent | Error |
| UNT0022 | Unity objects should not use null coalescing | Warning |
| UNT0024 | Prefer float math over double | Info |

[Full list available via `ulsm:list_unity_rules`]

### ULSM Custom Patterns (ULSM Rules)

| ID | Description | Severity |
|----|-------------|----------|
| ULSM0001 | Expensive call in hot path (GetComponent in Update) | Warning |
| ULSM0002 | String operation in hot path (allocation) | Warning |
| ULSM0003 | Debug.Log in hot path (performance) | Info |
| ULSM0004 | Camera.main in hot path (expensive property) | Warning |

### API Migration Categories

| Category | Example Deprecations |
|----------|---------------------|
| Input | `Input.GetAxis` → Input System |
| Networking | `NetworkBehaviour` → Netcode for GameObjects |
| Rendering | `Camera.stereoActiveEye` → XR APIs |
| XR | `XRSettings` → XR Management |
| Physics | Various query method updates |

## Example Prompts

### Unity-Specific Analysis

```
"Check my PlayerController for Unity anti-patterns"
"What Unity APIs in my project are deprecated in Unity 6?"
"Find all GetComponent calls in Update methods"
"List all Unity diagnostics in the Assembly-CSharp project"
```

### Impact Analysis

```
"Find all callers of the ProcessInput method"
"What code will break if I change this method signature?"
"Who uses the PlayerStats class?"
```

### Safe Refactoring

```
"Preview renaming IWeaponHandler to IWeapon"
"Safely rename ProcessInput to HandleInput across the solution"
```

### Dead Code Detection

```
"Find all unused code in the Scripts folder"
"What private methods are never called?"
"Show me unused ScriptableObjects"
```

## Architecture

```
┌─────────────────────────────────────────────┐
│       Claude Code (MCP Client)               │
└───────────────┬─────────────────────────────┘
                │ stdin/stdout (JSON-RPC 2.0)
┌───────────────▼─────────────────────────────┐
│            McpServer.cs                      │
│  - Protocol handling                         │
│  - Tool registration (22+ tools)             │
│  - Request routing                           │
└───────────────┬─────────────────────────────┘
                │
┌───────────────▼─────────────────────────────┐
│          RoslynService.cs                    │
│  - Solution management                       │
│  - Semantic analysis                         │
│  - Symbol resolution                         │
│  - Unity project detection                   │
└───────────────┬─────────────────────────────┘
                │
        ┌───────┴───────┐
        │               │
┌───────▼───────┐ ┌─────▼─────────────────────┐
│ MSBuildWork-  │ │    Unity/                 │
│ space         │ │  ├─ UnityProjectDetector  │
│ (Standard)    │ │  ├─ UnityWorkspaceLoader  │
│               │ │  ├─ UnityAnalysisService  │
│               │ │  └─ Analyzers/            │
│               │ │      ├─ UnityAnalyzerLoader│
│               │ │      ├─ UnityPatternAnalyzer│
│               │ │      └─ UnityApiMigrationData│
└───────────────┘ └───────────────────────────┘
```

## Troubleshooting

### Unity Project Not Detected

**Symptom:** Health check shows `isUnityProject: false` for a Unity project.

**Causes and Solutions:**

1. **No Assembly-CSharp.csproj**: Regenerate project files in Unity (Edit → Preferences → External Tools → Regenerate Project Files)

2. **Missing folder structure**: ULSM looks for `Assets/` and `ProjectSettings/` folders

3. **Relative solution path**: Use absolute paths in `DOTNET_SOLUTION_PATH`

### Framework Reference Errors

**Symptom:** Many CS0012 errors about missing types like `System.Object`.

**Solution:** Set `ULSM_FRAMEWORK_PATH` to your .NET Framework 4.7.1 reference assemblies:

```bash
# Windows
ULSM_FRAMEWORK_PATH="C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.7.1"

# macOS (with Mono)
ULSM_FRAMEWORK_PATH="/Library/Frameworks/Mono.framework/Versions/Current/lib/mono/4.7.1-api"
```

### MSBuild Workspace Failures

**Symptom:** Solution fails to load with MSBuild errors.

**Solution:** Try forcing AdhocWorkspace mode:

```bash
ULSM_FORCE_ADHOC=true
```

This bypasses MSBuild and parses .csproj files directly. You may lose some features but gain compatibility.

### Large Solution Timeout

**Symptom:** Loading times out for large Unity projects.

**Solution:** Increase the timeout:

```bash
ULSM_TIMEOUT_SECONDS=120
```

### Unity Analyzers Not Loading

**Symptom:** `ulsm:list_unity_rules` returns empty or `ulsm:unity_diagnostics` finds nothing.

**Solution:** Ensure the solution is loaded first:

1. Call `ulsm:load_solution` if not auto-loaded
2. Check `ulsm:health_check` shows "Ready" status
3. Verify `unityAnalyzersLoaded: true` in health check response

## Building from Source

```bash
# Clone the repository
git clone https://github.com/prespective/ulsm.git
cd ulsm

# Build
dotnet build ULSM.sln -c Release

# Run tests
dotnet test ULSM.sln

# Pack as global tool
dotnet pack src/ULSM.csproj -c Release

# Install locally
dotnet tool install --global --add-source ./src/bin/Release ulsm
```

### Running from Source (Development)

```bash
claude mcp add --transport stdio ulsm-dev \
  --env DOTNET_SOLUTION_PATH="/path/to/YourUnityProject.sln" \
  -- dotnet run --project /path/to/ulsm/src/ULSM.csproj
```

## MCP Client Configuration Examples

### Claude Code (Recommended)

**~/.claude/mcp_servers.json:**

```json
{
  "servers": {
    "ulsm": {
      "command": "ulsm",
      "args": [],
      "env": {
        "DOTNET_SOLUTION_PATH": "C:/Projects/MyUnityGame/MyUnityGame.sln",
        "ULSM_FRAMEWORK_PATH": "C:/Program Files (x86)/Reference Assemblies/Microsoft/Framework/.NETFramework/v4.7.1",
        "ULSM_LOG_LEVEL": "Information"
      }
    }
  }
}
```

### Project-Local Configuration

**.claude/mcp-spec.json** (in your Unity project root):

```json
{
  "mcpServers": {
    "ulsm": {
      "command": "ulsm",
      "env": {
        "DOTNET_SOLUTION_PATH": "${workspaceFolder}/MyGame.sln"
      }
    }
  }
}
```

### VS Code (with MCP extension)

**.vscode/settings.json:**

```json
{
  "mcp.servers": {
    "ulsm": {
      "command": "ulsm",
      "env": {
        "DOTNET_SOLUTION_PATH": "${workspaceFolder}/MyGame.sln"
      }
    }
  }
}
```

## Contributing

Contributions are welcome! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

### Development Setup

1. Fork and clone the repository
2. Open `ULSM.sln` in your IDE
3. Run tests: `dotnet test`
4. Make changes
5. Submit a pull request

## Credits

ULSM is a fork of [dotnet-roslyn-mcp](https://github.com/brendankowitz/dotnet-roslyn-mcp) by Brendan Kowitz, extended with Unity-specific capabilities by Prespective.

### Key Dependencies

- [Microsoft.CodeAnalysis (Roslyn)](https://github.com/dotnet/roslyn) - Compiler APIs
- [Microsoft.Unity.Analyzers](https://github.com/microsoft/Microsoft.Unity.Analyzers) - Unity-specific diagnostics
- [ModelContextProtocol](https://github.com/anthropics/model-context-protocol) - MCP SDK

## License

MIT License - See [LICENSE](LICENSE) for details.

---

*Built with Roslyn for Unity developers who want AI-powered code assistance that truly understands their codebase.*
```

---

### Task 2: Create CHANGELOG.md

Document all changes since forking from dotnet-roslyn-mcp.

**File:** `CHANGELOG.md`

```markdown
# Changelog

All notable changes to ULSM are documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.0.0] - 2026-02-04

### Added

#### Unity Project Support
- **UnityProjectDetector**: Automatic detection of Unity projects by:
  - Presence of `Assembly-CSharp.csproj` or `Assembly-CSharp-Editor.csproj`
  - HintPath references to `UnityEngine.dll` or `UnityEditor.dll`
  - Unity folder structure (`Assets/`, `ProjectSettings/`)
  - `ProjectVersion.txt` parsing for Unity version extraction

- **UnityWorkspaceLoader**: MSBuildWorkspace configuration for Unity's legacy csproj format:
  - `ToolsVersion="4.0"` compatibility
  - Cross-platform .NET Framework 4.7.1 reference assembly resolution
  - Environment variable overrides (`ULSM_FRAMEWORK_PATH`, `UNITY_EDITOR_PATH`)

- **UnityAdhocWorkspaceBuilder**: Fallback workspace loader that parses csproj files directly when MSBuild fails

#### Unity Analysis Tools
- **`ulsm:unity_diagnostics`**: Run Microsoft.Unity.Analyzers on Unity projects
  - 50+ Unity-specific diagnostic rules (UNT0001-UNT0xxx)
  - Category filtering (Performance, Correctness, etc.)
  - File or project-level analysis

- **`ulsm:check_unity_patterns`**: Custom pattern analyzer for Unity anti-patterns:
  - ULSM0001: Expensive calls in hot paths (GetComponent in Update)
  - ULSM0002: String operations in hot paths
  - ULSM0003: Debug.Log in hot paths
  - ULSM0004: Camera.main in hot paths

- **`ulsm:api_migration`**: Unity API deprecation checker:
  - 30+ migration rules for Unity 6.x
  - Categories: Input, Networking, Rendering, XR, Physics
  - Version-filtered results
  - Fix suggestions

- **`ulsm:list_unity_rules`**: List all available Unity diagnostic rules

#### Testing Infrastructure
- NUnit 4.x test project with 56 tests
- Minimal Unity test project structure for integration testing
- Unit tests for all Unity-specific components
- Integration tests with graceful skip when Unity DLLs unavailable

### Changed

#### Rebranding
- Renamed from `RoslynMcp` to `ULSM` (Unity Language Server MCP)
- Namespace changed from `RoslynMcp` to `ULSM`
- Tool prefix changed from `roslyn:` to `ulsm:`
- Package ID changed from `dotnet-roslyn-mcp` to `ulsm`
- Environment variables renamed from `ROSLYN_*` to `ULSM_*`

#### Health Check Enhancements
- Added `isUnityProject` field to health check response
- Added `unityVersion` field when Unity project detected
- Added `unityAnalyzersLoaded` status

#### Project Structure
- Added `src/Unity/` folder for Unity-specific code
- Added `src/Unity/Analyzers/` for analyzer infrastructure
- Added `tests/` folder with ULSM.Tests and UnityTestProject

### Technical Details

#### Dependencies Added
- `Microsoft.Unity.Analyzers` v1.19.0

#### New Files
```
src/Unity/
├── UnityProjectDetector.cs
├── UnityWorkspaceLoader.cs
├── UnityAdhocWorkspaceBuilder.cs
├── UnityAnalysisService.cs
└── Analyzers/
    ├── UnityAnalyzerLoader.cs
    ├── UnityPatternAnalyzer.cs
    └── UnityApiMigrationData.cs

tests/
├── ULSM.Tests/
│   ├── ULSM.Tests.csproj
│   ├── GlobalUsings.cs
│   ├── TestHelpers/
│   │   └── TestPaths.cs
│   ├── Unit/
│   │   ├── UnityProjectDetectorTests.cs
│   │   ├── UnityWorkspaceLoaderTests.cs
│   │   ├── UnityAnalyzerLoaderTests.cs
│   │   ├── UnityPatternAnalyzerTests.cs
│   │   └── UnityApiMigrationDataTests.cs
│   └── Integration/
│       ├── UnityProjectIntegrationTests.cs
│       └── UnityAnalysisIntegrationTests.cs
└── UnityTestProject/
    ├── Assembly-CSharp.csproj
    ├── UnityTestProject.sln
    ├── Assets/Scripts/
    └── ProjectSettings/
```

## Attribution

ULSM is a fork of [dotnet-roslyn-mcp](https://github.com/brendankowitz/dotnet-roslyn-mcp) (MIT License) by Brendan Kowitz.

Unity-specific enhancements by Prespective.
```

---

### Task 3: Update LICENSE File

Add Prespective attribution while preserving original MIT license.

**File:** `LICENSE` (modify existing)

Prepend to existing content or replace with:

```
MIT License

Copyright (c) 2026 Prespective (Unity-specific enhancements)
Copyright (c) 2025 Brendan Kowitz (Original dotnet-roslyn-mcp)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

### Task 4: Create CONTRIBUTING.md

**File:** `CONTRIBUTING.md`

```markdown
# Contributing to ULSM

Thank you for your interest in contributing to ULSM! This document provides guidelines for contributing.

## Development Setup

1. **Prerequisites**
   - .NET 8.0 SDK
   - (Optional) .NET Framework 4.7.1 Targeting Pack for Unity workspace testing

2. **Clone and Build**
   ```bash
   git clone https://github.com/prespective/ulsm.git
   cd ulsm
   dotnet build ULSM.sln
   ```

3. **Run Tests**
   ```bash
   dotnet test ULSM.sln
   ```

## Code Style

- Follow existing code conventions in the codebase
- Add XML documentation comments to all public types and members
- Use `Assert.That` style for NUnit tests
- Keep processing logic separate from data structures (functional style preferred)

## Pull Request Process

1. Fork the repository
2. Create a feature branch: `git checkout -b feature/your-feature`
3. Make your changes
4. Add tests for new functionality
5. Ensure all tests pass: `dotnet test`
6. Commit with conventional commit format: `feat: add new feature`
7. Push and create a Pull Request

## Commit Message Format

We use [Conventional Commits](https://www.conventionalcommits.org/):

- `feat:` - New features
- `fix:` - Bug fixes
- `docs:` - Documentation changes
- `test:` - Test additions or changes
- `refactor:` - Code refactoring
- `chore:` - Maintenance tasks

## Reporting Issues

- Use GitHub Issues for bug reports and feature requests
- Include reproduction steps for bugs
- Include Unity version and .NET SDK version

## Questions?

Open a GitHub Discussion or Issue for any questions about contributing.
```

---

### Task 5: Create Documentation/UserGuide.md

**File:** `Documentation/UserGuide.md`

```markdown
# ULSM User Guide

## Table of Contents

1. [Introduction](#introduction)
2. [Installation](#installation)
3. [Configuration](#configuration)
4. [Unity Project Setup](#unity-project-setup)
5. [Tool Reference](#tool-reference)
6. [Troubleshooting](#troubleshooting)
7. [FAQ](#faq)

---

## Introduction

ULSM (Unity Language Server MCP) is a Model Context Protocol server that provides Roslyn-based semantic code analysis specifically optimized for Unity projects. It enables AI coding assistants like Claude Code to understand your Unity codebase at a deep semantic level.

### Key Capabilities

- **Semantic Code Understanding**: Full compiler-accurate analysis of your C# code
- **Unity-Aware Analysis**: Understands MonoBehaviour lifecycle, Unity APIs, and common patterns
- **Anti-Pattern Detection**: Finds performance issues like GetComponent in Update loops
- **API Migration Assistance**: Identifies deprecated Unity APIs and suggests replacements
- **Safe Refactoring**: Rename symbols, extract interfaces, and organize code with preview

---

## Installation

### Global Tool Installation (Recommended)

```bash
dotnet tool install --global ulsm
```

### Verify Installation

```bash
ulsm --version
```

---

## Configuration

### Claude Code Configuration

Add ULSM to Claude Code:

```bash
claude mcp add --transport stdio ulsm \
  --env DOTNET_SOLUTION_PATH="/path/to/YourProject.sln" \
  -- ulsm
```

### Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `DOTNET_SOLUTION_PATH` | Yes | Path to your Unity project's .sln file |
| `ULSM_FRAMEWORK_PATH` | No | Override .NET Framework reference assembly path |
| `ULSM_FORCE_ADHOC` | No | Set to `true` to bypass MSBuild |
| `ULSM_LOG_LEVEL` | No | Logging verbosity (Debug, Information, Warning, Error) |
| `ULSM_TIMEOUT_SECONDS` | No | Operation timeout in seconds |

---

## Unity Project Setup

### Generating Project Files

Before using ULSM, ensure Unity has generated the .sln and .csproj files:

1. Open your Unity project
2. Go to **Edit → Preferences → External Tools**
3. Click **Regenerate project files**

### Required Files

ULSM detects Unity projects by looking for:

- `Assembly-CSharp.csproj` (main scripts)
- `Assets/` folder
- `ProjectSettings/` folder
- `ProjectSettings/ProjectVersion.txt`

### Framework Path Setup

Unity targets .NET Framework 4.7.1. For full reference resolution, install one of:

**Windows:**
- .NET Framework 4.7.1 Targeting Pack

**macOS/Linux:**
- Mono Framework

Or set `ULSM_FRAMEWORK_PATH` to your reference assemblies location.

---

## Tool Reference

### Unity-Specific Tools

#### ulsm:unity_diagnostics

Run Microsoft.Unity.Analyzers on your code.

**Parameters:**
- `filePath` (optional): Analyze specific file
- `projectPath` (optional): Analyze specific project
- `category` (optional): Filter by category (Performance, Correctness, etc.)

**Example prompt:** "Get Unity diagnostics for PlayerController.cs"

#### ulsm:check_unity_patterns

Find Unity anti-patterns using custom ULSM rules.

**Parameters:**
- `filePath`: File to analyze

**Example prompt:** "Check my EnemyAI script for performance anti-patterns"

#### ulsm:api_migration

Check for deprecated Unity APIs.

**Parameters:**
- `filePath` (optional): Check specific file
- `targetVersion` (optional): Unity version to target (default: 6000.0)
- `category` (optional): Filter by category (Input, Networking, etc.)

**Example prompt:** "What deprecated APIs am I using that need to change for Unity 6?"

#### ulsm:list_unity_rules

List all available Unity diagnostic rules.

**Example prompt:** "Show me all Unity analyzer rules"

### Navigation Tools

#### ulsm:find_references

Find all usages of a symbol.

**Example prompt:** "Find all references to the TakeDamage method"

#### ulsm:find_implementations

Find implementations of interfaces or virtual methods.

**Example prompt:** "What classes implement IWeapon?"

#### ulsm:find_callers

Find all methods that call a specific method.

**Example prompt:** "What code calls PlayerStats.AddExperience?"

### Refactoring Tools

#### ulsm:rename_symbol

Safely rename a symbol across the solution.

**Parameters:**
- `filePath`: File containing the symbol
- `line`: Line number
- `column`: Column number
- `newName`: New name
- `preview`: Set to true for preview only

**Example prompt:** "Rename the ProcessInput method to HandleInput"

---

## Troubleshooting

### "Unity project not detected"

1. Ensure `.sln` and `.csproj` files exist (regenerate in Unity if needed)
2. Use absolute path in `DOTNET_SOLUTION_PATH`
3. Check that `Assets/` and `ProjectSettings/` folders exist

### "Missing type references" (CS0012 errors)

1. Install .NET Framework 4.7.1 Targeting Pack (Windows)
2. Or set `ULSM_FRAMEWORK_PATH` manually
3. Or install Mono (macOS/Linux)

### "MSBuild failed to load solution"

1. Try `ULSM_FORCE_ADHOC=true` to bypass MSBuild
2. Check that all projects in the solution can be found
3. Regenerate project files in Unity

### "Analysis times out"

1. Increase `ULSM_TIMEOUT_SECONDS` (e.g., 120)
2. Ensure no other heavy processes are using the solution

---

## FAQ

**Q: Does ULSM require Unity to be installed?**

A: No. ULSM analyzes the code files without running Unity. However, having the .NET Framework reference assemblies helps with full type resolution.

**Q: Can I use ULSM with older Unity versions?**

A: Yes. ULSM supports Unity's legacy csproj format used by all recent Unity versions. The Unity-specific analyzers and migration rules are optimized for Unity 6.x but work with older versions.

**Q: Why aren't all Unity diagnostics showing?**

A: Some diagnostics require the actual Unity DLLs to be resolvable. Without them, the analyzer may not recognize certain Unity types.

**Q: Can I add custom analyzers?**

A: Currently, ULSM includes Microsoft.Unity.Analyzers and custom ULSM patterns. Adding custom analyzers would require source code modifications.

**Q: How do I report a bug or request a feature?**

A: Open an issue on the [GitHub repository](https://github.com/prespective/ulsm/issues).
```

---

### Task 6: Update server.json

Ensure server.json is complete and accurate.

**File:** `src/server.json` (review and update if needed)

The current server.json appears correct. Verify it includes:
- All 22+ tools properly categorized
- All environment variables documented
- Unity Analysis category with 4 tools

---

### Task 7: Update ULSM.csproj Package Metadata

Ensure the NuGet package metadata is complete.

**File:** `src/ULSM.csproj` (update PropertyGroup)

Verify/update these properties:

```xml
<PropertyGroup>
  <PackAsTool>true</PackAsTool>
  <ToolCommandName>ulsm</ToolCommandName>
  <PackageId>ulsm</PackageId>
  <Version>1.0.0</Version>
  <Authors>Prespective</Authors>
  <Company>Prespective</Company>
  <Product>ULSM</Product>
  <Description>Unity Language Server MCP - Roslyn-based code analysis for Unity 6.x projects via Model Context Protocol. Includes Unity-specific diagnostics, anti-pattern detection, and API migration checking.</Description>
  <Copyright>Copyright (c) 2026 Prespective. Based on dotnet-roslyn-mcp by Brendan Kowitz.</Copyright>
  <PackageLicenseExpression>MIT</PackageLicenseExpression>
  <PackageProjectUrl>https://github.com/prespective/ulsm</PackageProjectUrl>
  <RepositoryUrl>https://github.com/prespective/ulsm</RepositoryUrl>
  <RepositoryType>git</RepositoryType>
  <PackageTags>mcp;roslyn;unity;unity3d;csharp;code-analysis;claude-code;language-server;model-context-protocol</PackageTags>
  <PackageReadmeFile>README.md</PackageReadmeFile>
</PropertyGroup>

<ItemGroup>
  <None Include="..\README.md" Pack="true" PackagePath="\"/>
</ItemGroup>
```

---

### Task 8: Verify and Clean Up

#### 8.1 Remove Unused Files

Check for any leftover files from the original dotnet-roslyn-mcp that should be removed or updated:

- Old documentation referencing "Roslyn MCP Server"
- Any files still using `RoslynMcp` namespace
- Leftover test fixtures

#### 8.2 Verify Build and Tests

```bash
# Full build
dotnet build ULSM.sln -c Release

# All tests
dotnet test ULSM.sln

# Pack for distribution
dotnet pack src/ULSM.csproj -c Release
```

#### 8.3 Update .gitignore

Ensure `.gitignore` is appropriate for the project.

---

## Validation Checklist

### Documentation Files

- [ ] `README.md` completely rewritten for ULSM
- [ ] `CHANGELOG.md` created with all changes documented
- [ ] `LICENSE` updated with dual attribution
- [ ] `CONTRIBUTING.md` created
- [ ] `Documentation/UserGuide.md` created

### Package Metadata

- [ ] `src/ULSM.csproj` has complete package metadata
- [ ] `src/server.json` is accurate and complete
- [ ] Package builds successfully: `dotnet pack -c Release`

### Content Quality

- [ ] No references to "dotnet-roslyn-mcp" or "Roslyn MCP Server" in user-facing docs
- [ ] All tool names use `ulsm:` prefix
- [ ] All environment variables use `ULSM_` prefix
- [ ] Example configurations are correct and tested
- [ ] Troubleshooting covers common Unity issues

### Technical Validation

- [ ] `dotnet build ULSM.sln` succeeds
- [ ] `dotnet test ULSM.sln` all tests pass
- [ ] `dotnet pack src/ULSM.csproj -c Release` creates valid package

---

## Git Commit Strategy

### Commit 1: Create README.md

```bash
git add README.md
git commit -m "docs: rewrite README for ULSM

Complete rewrite of documentation for Unity Language Server MCP.
Includes installation, configuration, tool reference, troubleshooting,
and MCP client configuration examples."
```

### Commit 2: Create CHANGELOG.md

```bash
git add CHANGELOG.md
git commit -m "docs: add CHANGELOG documenting fork changes

Document all changes from dotnet-roslyn-mcp fork including:
- Unity project detection and workspace loading
- Unity analysis tools (4 new tools)
- Testing infrastructure (56 tests)
- Namespace and branding changes"
```

### Commit 3: Update LICENSE

```bash
git add LICENSE
git commit -m "docs: update LICENSE with dual attribution

Add Prespective copyright for Unity-specific enhancements
while preserving original Brendan Kowitz attribution."
```

### Commit 4: Create Supporting Documentation

```bash
git add CONTRIBUTING.md Documentation/UserGuide.md
git commit -m "docs: add CONTRIBUTING guide and User Guide

- CONTRIBUTING.md with development setup and PR process
- Documentation/UserGuide.md with detailed usage instructions"
```

### Commit 5: Update Package Metadata

```bash
git add src/ULSM.csproj
git commit -m "chore: update NuGet package metadata for release

- Add comprehensive package description and tags
- Include README in package
- Set repository and project URLs"
```

### Commit 6: Add Assignment Prompt

```bash
git add Prompts/PP13-107/
git commit -m "docs: add PP13-107 Phase 5 assignment prompt

Comprehensive documentation and polish implementation guide
for final phase of ULSM development."
```

---

## Dev Diary Logging

### At Start

```
/devdiary ASSIGNMENT: Create Diary Entry
issue_id: PP13-107
entry_type: plan
content: Starting Phase 5 implementation - Documentation and Polish. Final phase tasks: (1) Rewrite README.md with ULSM branding and Unity documentation, (2) Create CHANGELOG.md documenting all fork changes, (3) Update LICENSE with dual attribution, (4) Create CONTRIBUTING.md and Documentation/UserGuide.md, (5) Update ULSM.csproj package metadata, (6) Verify server.json completeness, (7) Clean up any remaining old references, (8) Validate build and tests.
```

### During Implementation

Log completion of each documentation file with specific details.

### On Completion

```
/devdiary ASSIGNMENT: Create Diary Entry
issue_id: PP13-107
entry_type: work
content: Phase 5 complete - Documentation and Polish. Created: README.md (ULSM-focused, ~400 lines), CHANGELOG.md (v1.0.0 changes), CONTRIBUTING.md, Documentation/UserGuide.md. Updated LICENSE with dual attribution, ULSM.csproj package metadata. All documentation references ULSM branding, ulsm: tool prefix, ULSM_* environment variables. Build and tests pass. Project ready for release.
```

---

## Success Criteria

Phase 5 (and the entire ULSM project) is complete when:

### Documentation

- [ ] README.md is a complete, professional project README
- [ ] CHANGELOG.md documents all changes from fork
- [ ] LICENSE has proper attribution
- [ ] CONTRIBUTING.md provides development guidelines
- [ ] UserGuide.md provides detailed usage instructions

### Branding Consistency

- [ ] No user-facing references to "Roslyn MCP Server" or "dotnet-roslyn-mcp"
- [ ] All tools use `ulsm:` prefix
- [ ] All environment variables use `ULSM_*` prefix
- [ ] Package ID is `ulsm`

### Package Readiness

- [ ] Package metadata is complete
- [ ] Package builds successfully
- [ ] README is included in NuGet package

### Quality

- [ ] All tests pass
- [ ] Documentation is accurate and helpful
- [ ] Example configurations work correctly

---

## Release Checklist (Post-Documentation)

After documentation is complete, these final steps prepare for release:

1. **Create Release Tag**
   ```bash
   git tag -a v1.0.0 -m "ULSM v1.0.0 - Unity Language Server MCP"
   git push origin v1.0.0
   ```

2. **Publish to NuGet** (if applicable)
   ```bash
   dotnet nuget push src/bin/Release/ulsm.1.0.0.nupkg --source https://api.nuget.org/v3/index.json
   ```

3. **Create GitHub Release**
   - Title: "ULSM v1.0.0 - Unity Language Server MCP"
   - Include CHANGELOG.md content in release notes
   - Attach compiled binaries if desired

---

## Appendix A: File Checklist

| File | Status | Action |
|------|--------|--------|
| `README.md` | Outdated | **Replace** |
| `CHANGELOG.md` | Missing | **Create** |
| `LICENSE` | Needs update | **Modify** |
| `CONTRIBUTING.md` | Missing | **Create** |
| `Documentation/UserGuide.md` | Missing | **Create** |
| `src/server.json` | Current | **Verify** |
| `src/ULSM.csproj` | Needs update | **Modify** |

## Appendix B: Branding Search/Replace

Before completing, search for these terms and ensure they're updated:

| Search For | Should Be | Files to Check |
|------------|-----------|----------------|
| `RoslynMcp` | `ULSM` | All .cs files, .csproj |
| `roslyn:` | `ulsm:` | McpServer.cs, docs |
| `ROSLYN_` | `ULSM_` | server.json, docs |
| `dotnet-roslyn-mcp` | `ulsm` | README, CHANGELOG |
| `Roslyn MCP Server` | `ULSM` | README, docs |

## Appendix C: Documentation Style Guide

- Use consistent heading hierarchy (# for title, ## for sections, ### for subsections)
- Include code examples in fenced blocks with language tags
- Use tables for structured data (env vars, tools, etc.)
- Keep line length reasonable for markdown rendering
- Test all code examples before documenting
